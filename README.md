# Demo-Description

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨ä¸º CLINE AI ç¼–ç åŠ©æ‰‹æ„å»ºä¸€ä¸ªåˆ›æ–°çš„å¯è§†åŒ–æ¶æ„ï¼Œé€šè¿‡ SubAgent æœºåˆ¶å®ç°ä¸ MCP (Model Context Protocol) æœåŠ¡å™¨çš„è§£è€¦å’Œå¯è§‚æµ‹æ€§å¢å¼ºã€‚

### æ ¸å¿ƒä»·å€¼
1. **è§£è€¦æ€§**ï¼šMain Agent ä¸ç›´æ¥å¤„ç† MCP å¤æ‚æ€§ï¼Œé€šè¿‡ SubAgent ä¸­é—´å±‚éš”ç¦»
2. **å¯è§‚æµ‹æ€§**ï¼šæ¯ä¸€æ­¥æ“ä½œéƒ½å¯è¿½è¸ªã€å¯è§†åŒ–ã€å¯è°ƒè¯•
3. **å¯æ‰©å±•æ€§**ï¼šè½»æ¾æ·»åŠ æ–°çš„ MCP æœåŠ¡ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒé€»è¾‘
4. **ç”¨æˆ·å‹å¥½**ï¼šå®æ—¶å±•ç¤º AI çš„å·¥ä½œæµç¨‹ï¼Œæå‡é€æ˜åº¦å’Œå¯æ§æ€§

---

## æ¶æ„è®¾è®¡

### 1. æ•´ä½“å±‚æ¬¡ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      UI Layer (å‰ç«¯å¯è§†åŒ–)                   â”‚
â”‚  - Real-time Graph Visualization            â”‚
â”‚  - Interactive Hover Panels                 â”‚
â”‚  - Event Timeline                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Main Agent (CLINE ä¸»æ™ºèƒ½ä½“)            â”‚
â”‚  - Task Planning & Decision Making          â”‚
â”‚  - Routing to SubAgents                     â”‚
â”‚  - Result Aggregation                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      SubAgent Manager (ç®¡ç†å±‚)              â”‚
â”‚  - SubAgent Lifecycle Management            â”‚
â”‚  - Connection Pool Management               â”‚
â”‚  - Load Balancing                           â”‚
â”‚  - Event Broadcasting                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      SubAgent Pool (å¤šä¸ª SubAgent å®ä¾‹)     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚SubAgent 1â”‚  â”‚SubAgent 2â”‚  â”‚SubAgent 3â”‚  â”‚
â”‚  â”‚(FileSystem)â”‚  â”‚(Git)    â”‚  â”‚(Database)â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      MCP Servers (å®é™…åŠŸèƒ½æœåŠ¡)             â”‚
â”‚  - File Operations                          â”‚
â”‚  - Git Operations                           â”‚
â”‚  - Database Queries                         â”‚
â”‚  - Custom Tools                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. æ ¸å¿ƒç»„ä»¶è¯¦ç»†è®¾è®¡

#### 2.1 Main Agent (CLINE)

**èŒè´£**ï¼š
- ç†è§£ç”¨æˆ·æ„å›¾å¹¶åˆ¶å®šä»»åŠ¡è®¡åˆ’
- åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨ MCP æœåŠ¡
- é€šè¿‡ SubAgent Manager è·¯ç”±åˆ°å¯¹åº”çš„ SubAgent
- èšåˆ SubAgent è¿”å›çš„ç»“æœ
- **ä¸ç›´æ¥ä¸ MCP æœåŠ¡å™¨äº¤äº’**

**å·¥ä½œæµç¨‹**ï¼š
```
ç”¨æˆ·è¯·æ±‚ â†’ åˆ†æä»»åŠ¡ â†’ åˆ¤æ–­éœ€è¦çš„å·¥å…· â†’ è·¯ç”±åˆ° SubAgent â†’ ç­‰å¾…ç»“æœ â†’ ç»§ç»­å†³ç­–
```

---

#### 2.2 SubAgent Manager

**èŒè´£**ï¼š
- ç®¡ç†æ‰€æœ‰ SubAgent çš„ç”Ÿå‘½å‘¨æœŸï¼ˆåˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€é”€æ¯ï¼‰
- ç»´æŠ¤ SubAgent ä¸ MCP æœåŠ¡å™¨çš„æ˜ å°„å…³ç³»
- å®ç°è¿æ¥æ± æœºåˆ¶ï¼ˆå¤ç”¨è¿æ¥ï¼Œå‡å°‘å¼€é”€ï¼‰
- å¤„ç†è´Ÿè½½å‡è¡¡ï¼ˆåŒç±»å‹å¤šå®ä¾‹ï¼‰
- å¹¿æ’­æ‰€æœ‰äº‹ä»¶åˆ° UI å±‚

**æ•°æ®ç»“æ„**ï¼š
```typescript
interface SubAgentManager {
  subagents: Map<string, SubAgent>;
  mcpConnections: Map<string, MCPConnection>;

  // æ ¸å¿ƒæ–¹æ³•
  getOrCreateSubAgent(mcpType: string): SubAgent;
  routeToSubAgent(toolName: string, params: any): Promise<any>;
  broadcastEvent(event: AgentEvent): void;

  // è¿æ¥æ± ç®¡ç†
  connectionPool: ConnectionPool;
  scaleUp(mcpType: string): void;
  scaleDown(mcpType: string): void;
}
```

---

#### 2.3 SubAgentï¼ˆæ ¸å¿ƒç»„ä»¶ï¼‰

**èŒè´£**ï¼š
- å°è£…ä¸€ä¸ªç‰¹å®šçš„ MCP æœåŠ¡å™¨
- ç»´æŠ¤ä¸ MCP æœåŠ¡å™¨çš„æŒä¹…è¿æ¥
- æš´éœ²è¯¥ MCP æœåŠ¡å™¨çš„æ‰€æœ‰å·¥å…·
- è¿½è¸ªè‡ªå·±çš„æ‰€æœ‰æ“ä½œå†å²
- å®æ—¶å¹¿æ’­è‡ªå·±çš„çŠ¶æ€å˜åŒ–

**æ•°æ®æ¨¡å‹**ï¼š
```typescript
interface SubAgent {
  // åŸºæœ¬ä¿¡æ¯
  id: string;
  name: string;
  mcpServerType: "filesystem" | "git" | "database" | "custom";
  status: "idle" | "connecting" | "ready" | "executing" | "error";

  // è¿æ¥ä¿¡æ¯
  connection: {
    mcpServerUrl: string;
    connected: boolean;
    connectedAt: timestamp;
    lastPing: timestamp;
    reconnectAttempts: number;
  };

  // å·¥å…·ä¿¡æ¯
  tools: Tool[];

  // æ‰§è¡Œå†å²
  executionHistory: ToolExecution[];

  // æ€§èƒ½æŒ‡æ ‡
  metrics: {
    totalExecutions: number;
    successRate: number;
    avgDuration: number;
    lastExecuted: timestamp;
    errorCount: number;
  };

  // æ ¸å¿ƒæ–¹æ³•
  connect(): Promise<void>;
  disconnect(): Promise<void>;
  executeTool(toolName: string, params: any): Promise<any>;
  broadcastStatus(): void;
}
```

**çŠ¶æ€æœº**ï¼š
```
IDLE (ç©ºé—²)
  â†“ (Main Agent è°ƒç”¨)
CONNECTING (è¿æ¥ MCP)
  â†“ (è¿æ¥æˆåŠŸ)
READY (å·²è¿æ¥ï¼Œç­‰å¾…ä»»åŠ¡)
  â†“ (æ”¶åˆ°å·¥å…·è°ƒç”¨è¯·æ±‚)
EXECUTING (æ‰§è¡Œä¸­)
  â”œâ†’ SUCCESS â†’ READY
  â”œâ†’ ERROR â†’ READY (å¯é‡è¯•)
  â””â†’ FATAL_ERROR â†’ RECONNECTING
```

---

#### 2.4 Tool Executionï¼ˆå·¥å…·æ‰§è¡Œï¼‰

**æ•°æ®æ¨¡å‹**ï¼š
```typescript
interface ToolExecution {
  // åŸºæœ¬ä¿¡æ¯
  id: string;
  toolName: string;
  subagentId: string;

  // çŠ¶æ€
  status: "queued" | "running" | "streaming" | "completed" | "failed";

  // è¾“å…¥è¾“å‡º
  input: {
    data: any;
    timestamp: timestamp;
    size: number;
  };

  output: {
    data: any;
    chunks: any[];  // æµå¼è¾“å‡ºçš„åˆ†å—
    timestamp: timestamp;
    size: number;
  };

  // æ—¶é—´ä¿¡æ¯
  timing: {
    queuedAt: timestamp;
    startedAt: timestamp;
    completedAt: timestamp;
    duration: number;
  };

  // é”™è¯¯ä¿¡æ¯
  error?: {
    message: string;
    stack: string;
    code: string;
  };
}
```

---

### 3. æ•°æ®æµè®¾è®¡

#### 3.1 æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. User Request                              â”‚
â”‚    "è¯»å– /src/main.py æ–‡ä»¶"                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Main Agent åˆ†æ                           â”‚
â”‚    - è¯†åˆ«éœ€è¦ filesystem å·¥å…·                â”‚
â”‚    - å†³å®šè°ƒç”¨ read_file                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. SubAgent Manager è·¯ç”±                     â”‚
â”‚    - æŸ¥æ‰¾/åˆ›å»º FileSystem SubAgent           â”‚
â”‚    - æ£€æŸ¥è¿æ¥çŠ¶æ€                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. SubAgent å»ºç«‹è¿æ¥ï¼ˆå¦‚æœæœªè¿æ¥ï¼‰           â”‚
â”‚    SubAgent â†â†’ MCP Server                    â”‚
â”‚    - æ¡æ‰‹                                    â”‚
â”‚    - å·¥å…·åˆ—è¡¨è·å–                            â”‚
â”‚    - çŠ¶æ€æ›´æ–°: CONNECTING â†’ READY            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. SubAgent æ‰§è¡Œå·¥å…·                         â”‚
â”‚    - è®°å½•è¾“å…¥å‚æ•°                            â”‚
â”‚    - è°ƒç”¨ MCP å·¥å…· read_file                 â”‚
â”‚    - æ¥æ”¶è¾“å‡ºï¼ˆå¯èƒ½æ˜¯æµå¼ï¼‰                  â”‚
â”‚    - è®°å½•è¾“å‡ºç»“æœ                            â”‚
â”‚    - å¹¿æ’­æ‰§è¡ŒçŠ¶æ€                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. è¿”å›ç»“æœç»™ Main Agent                     â”‚
â”‚    - æˆåŠŸï¼šæ–‡ä»¶å†…å®¹                          â”‚
â”‚    - å¤±è´¥ï¼šé”™è¯¯ä¿¡æ¯                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Main Agent ç»§ç»­å†³ç­–                       â”‚
â”‚    - å¤„ç†æ–‡ä»¶å†…å®¹                            â”‚
â”‚    - å†³å®šä¸‹ä¸€æ­¥æ“ä½œ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 3.2 çŠ¶æ€è¿½è¸ªæµ

æ‰€æœ‰æ“ä½œéƒ½ä¼šäº§ç”Ÿäº‹ä»¶æµï¼Œé€šè¿‡ WebSocket å®æ—¶æ¨é€åˆ°å‰ç«¯ï¼š

**Main Agent å±‚äº‹ä»¶**ï¼š
```typescript
{
  type: "main_agent_event",
  event: "thinking" | "routing" | "waiting" | "processing",
  data: {
    message: string;
    targetSubAgent?: string;
    timestamp: number;
  }
}
```

**SubAgent å±‚äº‹ä»¶**ï¼š
```typescript
{
  type: "subagent_event",
  subagentId: string;
  event: "activated" | "connecting" | "connected" | "executing" | "idle" | "error",
  data: {
    status: string;
    toolName?: string;
    connectionInfo?: object;
    timestamp: number;
  }
}
```

**Tool å±‚äº‹ä»¶**ï¼š
```typescript
{
  type: "tool_event",
  subagentId: string;
  toolName: string;
  event: "called" | "executing" | "output_chunk" | "completed" | "error",
  data: {
    input?: any;
    output?: any;
    chunk?: any;
    progress?: number;
    error?: string;
    timestamp: number;
  }
}
```

---

## UI å¯è§†åŒ–è®¾è®¡

### 1. å›¾çš„å±‚æ¬¡ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Main Agent Graph                       â”‚
â”‚                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    â”‚ Think  â”‚ â”€â”€â†’â”‚ Routeâ”‚ â”€â”€â†’â”‚ Decide â”‚         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                       â”‚                          â”‚
â”‚                  éœ€è¦ MCP æœåŠ¡æ—¶                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â†“               â†“               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SubAgent 1   â”‚ â”‚ SubAgent 2   â”‚ â”‚ SubAgent 3   â”‚
â”‚ (FileSystem) â”‚ â”‚ (Git)        â”‚ â”‚ (Database)   â”‚
â”‚              â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ â—‹ read_file  â”‚ â”‚ â—‹ commit     â”‚ â”‚ â—‹ query      â”‚
â”‚ â—‹ write_file â”‚ â”‚ â—‹ push       â”‚ â”‚ â—‹ insert     â”‚
â”‚ â—‹ list_dir   â”‚ â”‚ â—‹ pull       â”‚ â”‚ â—‹ update     â”‚
â”‚ â—‹ delete     â”‚ â”‚ â—‹ branch     â”‚ â”‚ â—‹ delete     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. é¼ æ ‡æ‚¬æµ®äº¤äº’è®¾è®¡

#### 2.1 æ‚¬æµ®åœ¨ SubAgent èŠ‚ç‚¹ä¸Š

æ˜¾ç¤ºå®æ—¶é¢æ¿ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SubAgent: FileSystem MCP                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Status: â— Executing                      â”‚
â”‚ Connected to: mcp-server-fs:8080         â”‚
â”‚ Uptime: 5m 23s                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Real-time Activity Stream:               â”‚
â”‚                                          â”‚
â”‚ [12:34:01.234] Tool called: read_file    â”‚
â”‚   Input: {                               â”‚
â”‚     path: "/src/main.py"                 â”‚
â”‚     encoding: "utf-8"                    â”‚
â”‚   }                                      â”‚
â”‚   â³ Executing... (1.2s elapsed)         â”‚
â”‚                                          â”‚
â”‚ [12:33:58.456] Tool completed: list_dir  â”‚
â”‚   Output: ["file1.py", "file2.py", ...]  â”‚
â”‚   âœ“ Success (120ms)                      â”‚
â”‚                                          â”‚
â”‚ [12:33:55.789] Connected to MCP Server   â”‚
â”‚   âœ“ Handshake successful                 â”‚
â”‚   âœ“ Tools loaded: 15                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Statistics:                              â”‚
â”‚ â€¢ Available Tools: 15                    â”‚
â”‚ â€¢ Total Executions: 47                   â”‚
â”‚ â€¢ Success Rate: 98.7%                    â”‚
â”‚ â€¢ Avg Response Time: 89ms                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 2.2 æ‚¬æµ®åœ¨ Tool èŠ‚ç‚¹ä¸Š

æ˜¾ç¤ºå·¥å…·æ‰§è¡Œè¯¦æƒ…ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tool: read_file                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Status: â— Executing                      â”‚
â”‚ Started: 12:34:01.234                    â”‚
â”‚ Duration: 1.2s                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input Stream:                            â”‚
â”‚ {                                        â”‚
â”‚   "path": "/src/main.py",                â”‚
â”‚   "encoding": "utf-8",                   â”‚
â”‚   "options": {                           â”‚
â”‚     "includeLineNumbers": true           â”‚
â”‚   }                                      â”‚
â”‚ }                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Output Stream: (streaming... 47%)        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Line 1: import os                  â”‚   â”‚
â”‚ â”‚ Line 2: import sys                 â”‚   â”‚
â”‚ â”‚ Line 3: from typing import *       â”‚   â”‚
â”‚ â”‚ ...                                â”‚   â”‚
â”‚ â”‚ â³ Reading (473 / 1000 lines)      â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ History:                                 â”‚
â”‚ â€¢ Last used: 2s ago                      â”‚
â”‚ â€¢ Total calls today: 156                 â”‚
â”‚ â€¢ Avg duration: 89ms                     â”‚
â”‚ â€¢ Success rate: 100%                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. è§†è§‰è®¾è®¡è¦ç‚¹

#### 3.1 èŠ‚ç‚¹çŠ¶æ€é¢œè‰²ç¼–ç 

**Main Agent**ï¼š
- ğŸŸ¡ Thinking: é»„è‰²è„‰åŠ¨åŠ¨ç”»
- ğŸŸ¦ Routing: è“è‰²ï¼Œç®­å¤´æµåŠ¨åŠ¨ç”»
- âšª Waiting: ç°è‰²ï¼Œè™šçº¿è¾¹æ¡†
- ğŸŸ¢ Processing: ç»¿è‰²ï¼Œå®çº¿è¾¹æ¡†

**SubAgent**ï¼š
- âšª Idle: ç°è‰²ï¼Œé€æ˜åº¦ 50%
- ğŸŸ  Connecting: æ©™è‰²ï¼ŒåŠ è½½åŠ¨ç”»
- ğŸŸ¢ Ready: ç»¿è‰²ï¼Œå®çº¿è¾¹æ¡†
- ğŸ”µ Executing: è“è‰²ï¼Œè„‰åŠ¨åŠ¨ç”»
- ğŸ”´ Error: çº¢è‰²ï¼ŒæŠ–åŠ¨åŠ¨ç”»

**Tool**ï¼š
- âšª Queued: ç™½è‰²ï¼Œè™šçº¿è¾¹æ¡†
- ğŸ”µ Running: è“è‰²ï¼Œè¿›åº¦æ¡åŠ¨ç”»
- ğŸŒŠ Streaming: æµåŠ¨æ¸å˜æ•ˆæœ
- âœ… Completed: ç»¿è‰²ï¼Œå‹¾é€‰å›¾æ ‡
- âŒ Failed: çº¢è‰²ï¼Œå‰å·å›¾æ ‡

---

#### 3.2 è¿æ¥çº¿åŠ¨ç”»

**Main Agent â†’ SubAgent**ï¼š
- è°ƒç”¨æ—¶ï¼šè™šçº¿æµåŠ¨åŠ¨ç”»ï¼ˆç²’å­ä» Main â†’ SubAgentï¼‰
- ç­‰å¾…æ—¶ï¼šé™æ€è™šçº¿
- è¿”å›æ—¶ï¼šå®çº¿æµåŠ¨åŠ¨ç”»ï¼ˆç²’å­ä» SubAgent â†’ Mainï¼‰

**SubAgent â†’ Tool**ï¼š
- æ‰§è¡Œæ—¶ï¼šç²’å­æµåŠ¨æ•ˆæœ
- å®Œæˆæ—¶ï¼šé—ªçƒé«˜äº®ä¸€æ¬¡

---

## å®æ—¶æ•°æ®æµæœºåˆ¶

### 1. WebSocket äº‹ä»¶æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Frontend (React)                â”‚
â”‚  - Graph Visualization (D3.js)          â”‚
â”‚  - Real-time Updates                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      WebSocket Server                   â”‚
â”‚  - Event Broadcasting                   â”‚
â”‚  - Client Management                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Event Bus                       â”‚
â”‚  - Event Queue                          â”‚
â”‚  - Event Filtering                      â”‚
â”‚  - Event Aggregation                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Main    â”‚ â”‚SubAgentâ”‚ â”‚SubAgentâ”‚
â”‚  Agent   â”‚ â”‚   1    â”‚ â”‚   2    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
           â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
           â”‚ MCP Client â”‚
           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
           â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
           â”‚ MCP Server â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. äº‹ä»¶å¤„ç†æµç¨‹

```typescript
// 1. SubAgent äº§ç”Ÿäº‹ä»¶
subAgent.executeTool("read_file", params);
  â†“
subAgent.emit("tool_executing", {
  toolName: "read_file",
  input: params,
  timestamp: Date.now()
});

// 2. Event Bus æ¥æ”¶å¹¶å¹¿æ’­
eventBus.on("tool_executing", (event) => {
  // è¿‡æ»¤ã€èšåˆã€æ ¼å¼åŒ–
  const formattedEvent = formatEvent(event);

  // å¹¿æ’­åˆ° WebSocket
  wsServer.broadcast(formattedEvent);
});

// 3. å‰ç«¯æ¥æ”¶å¹¶æ›´æ–° UI
wsClient.on("message", (event) => {
  // æ›´æ–°å›¾èŠ‚ç‚¹çŠ¶æ€
  updateGraphNode(event.subagentId, event.status);

  // æ›´æ–°æ‚¬æµ®é¢æ¿ï¼ˆå¦‚æœæ‰“å¼€ï¼‰
  if (hoveredNode === event.subagentId) {
    updateHoverPanel(event);
  }

  // æ·»åŠ åˆ°äº‹ä»¶æ—¶é—´çº¿
  addToTimeline(event);
});
```

---

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. SubAgent è¿æ¥æ± 

**é—®é¢˜**ï¼šæ¯æ¬¡åˆ›å»ºæ–°è¿æ¥å¼€é”€å¤§ï¼Œå“åº”æ…¢

**æ–¹æ¡ˆ**ï¼š
```typescript
class ConnectionPool {
  pools: Map<string, SubAgent[]>;

  // é¢„åˆ›å»ºå¸¸ç”¨ MCP æœåŠ¡çš„ SubAgent
  async initialize() {
    this.createPool("filesystem", 3);
    this.createPool("git", 2);
    this.createPool("database", 2);
  }

  // åŠ¨æ€æ‰©å®¹
  async scaleUp(mcpType: string, count: number) {
    for (let i = 0; i < count; i++) {
      const agent = await this.createSubAgent(mcpType);
      this.pools.get(mcpType).push(agent);
    }
  }

  // ç©ºé—²ç¼©å®¹
  async scaleDown(mcpType: string) {
    const pool = this.pools.get(mcpType);
    const idleAgents = pool.filter(a => a.isIdle() && a.idleTime > 5 * 60 * 1000);

    for (const agent of idleAgents) {
      await agent.disconnect();
      pool.splice(pool.indexOf(agent), 1);
    }
  }
}
```

---

### 2. äº‹ä»¶èŠ‚æµ

**é—®é¢˜**ï¼šå·¥å…·è¾“å‡ºæµå¤ªå¿«ï¼ˆå¦‚å¤§æ–‡ä»¶è¯»å–ï¼‰ï¼ŒUI åˆ·æ–°å¡é¡¿

**æ–¹æ¡ˆ**ï¼š
```typescript
class EventThrottler {
  buffer: Event[] = [];
  flushInterval: number = 100; // ms

  constructor() {
    setInterval(() => this.flush(), this.flushInterval);
  }

  add(event: Event) {
    this.buffer.push(event);

    // å¦‚æœç¼“å†²åŒºè¿‡å¤§ï¼Œç«‹å³åˆ·æ–°
    if (this.buffer.length > 100) {
      this.flush();
    }
  }

  flush() {
    if (this.buffer.length === 0) return;

    // æ‰¹é‡å‘é€
    wsServer.broadcast({
      type: "batch_events",
      events: this.buffer
    });

    this.buffer = [];
  }
}
```

---

### 3. å†å²æ•°æ®ç®¡ç†

**é—®é¢˜**ï¼šæ‰§è¡Œè®°å½•è¶Šæ¥è¶Šå¤šï¼Œå†…å­˜çˆ†ç‚¸

**æ–¹æ¡ˆ**ï¼š
```typescript
class ExecutionHistoryManager {
  inMemoryLimit: number = 100;

  async addExecution(exec: ToolExecution) {
    // æ·»åŠ åˆ°å†…å­˜
    subAgent.executionHistory.push(exec);

    // å¦‚æœè¶…è¿‡é™åˆ¶ï¼ŒæŒä¹…åŒ–æ—§æ•°æ®
    if (subAgent.executionHistory.length > this.inMemoryLimit) {
      const oldExecs = subAgent.executionHistory.splice(0, 50);
      await this.persistToDatabase(oldExecs);
    }
  }

  async getHistory(subAgentId: string, offset: number, limit: number) {
    // å…ˆä»å†…å­˜è·å–
    let result = subAgent.executionHistory.slice(offset, offset + limit);

    // å¦‚æœä¸å¤Ÿï¼Œä»æ•°æ®åº“åŠ è½½
    if (result.length < limit) {
      const dbResult = await this.loadFromDatabase(subAgentId, offset, limit);
      result = result.concat(dbResult);
    }

    return result;
  }
}
```

---

## ä¸ CLINE çš„é›†æˆ

### 1. CLINE ç°æœ‰æ¶æ„

```
CLINE (VSCode Extension)
  â”œâ”€ Webview (UI å±‚)
  â”‚   â”œâ”€ Chat Interface
  â”‚   â”œâ”€ Task Management
  â”‚   â””â”€ Settings
  â”‚
  â”œâ”€ Extension Host (ä¸»é€»è¾‘)
  â”‚   â”œâ”€ CLINE Core (AI Agent)
  â”‚   â”œâ”€ MCP Manager (ç°æœ‰)
  â”‚   â”œâ”€ File Watcher
  â”‚   â””â”€ Terminal Integration
  â”‚
  â””â”€ Language Server
      â””â”€ Code Analysis
```

---

### 2. é›†æˆæ–¹æ¡ˆ

#### æ–¹æ¡ˆ Aï¼šExtension Host å†…é›†æˆï¼ˆæ¨èï¼‰

```
Extension Host
  â”œâ”€ CLINE Core (ç°æœ‰)
  â”‚
  â”œâ”€ SubAgent Manager (æ–°å¢)
  â”‚   â”œâ”€ SubAgent Pool
  â”‚   â”œâ”€ Connection Pool
  â”‚   â””â”€ Event Bus
  â”‚
  â”œâ”€ MCP Client Pool (æ–°å¢)
  â”‚   â”œâ”€ Filesystem MCP Client
  â”‚   â”œâ”€ Git MCP Client
  â”‚   â””â”€ Custom MCP Clients
  â”‚
  â””â”€ Event Broadcaster (æ–°å¢)
      â””â”€ WebSocket Server
```

**ä¼˜ç‚¹**ï¼š
- å®ç°ç®€å•ï¼Œæ— éœ€é¢å¤–è¿›ç¨‹
- å…±äº«å†…å­˜ï¼Œæ€§èƒ½å¥½
- ä¾¿äºè°ƒè¯•

**ç¼ºç‚¹**ï¼š
- å¯èƒ½å½±å“ Extension Host æ€§èƒ½
- éš¾ä»¥ç‹¬ç«‹æ‰©å±•

---

#### æ–¹æ¡ˆ Bï¼šç‹¬ç«‹æœåŠ¡ï¼ˆé«˜æ€§èƒ½åœºæ™¯ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLINE Extension         â”‚
â”‚  (VSCode Extension Host) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SubAgent Service        â”‚
â”‚  (ç‹¬ç«‹ Node.js è¿›ç¨‹)      â”‚
â”‚                          â”‚
â”‚  â”œâ”€ SubAgent Manager     â”‚
â”‚  â”œâ”€ MCP Client Pool      â”‚
â”‚  â”œâ”€ Event Bus            â”‚
â”‚  â””â”€ WebSocket Server     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜ç‚¹**ï¼š
- è§£è€¦ï¼Œä¸å½±å“ Extension Host
- å¯ç‹¬ç«‹æ‰©å±•å’Œéƒ¨ç½²
- æ”¯æŒå¤šå®ä¾‹è´Ÿè½½å‡è¡¡

**ç¼ºç‚¹**ï¼š
- å®ç°å¤æ‚
- éœ€è¦è¿›ç¨‹é—´é€šä¿¡
- éƒ¨ç½²å’Œé…ç½®å¤æ‚

---

### 3. UI å¯è§†åŒ–ä½ç½®

#### é€‰é¡¹ 1ï¼šåµŒå…¥å¼é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLINE Chat Interface (ç°æœ‰)           â”‚
â”‚  [User]  ä½ å¥½ï¼Œå¸®æˆ‘è¯»å–æ–‡ä»¶            â”‚
â”‚  [CLINE] å¥½çš„ï¼Œæ­£åœ¨è¯»å–...              â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Agent Flow (æ–°å¢)                â”‚ â”‚
â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚  [Main Agent]                    â”‚ â”‚
â”‚  â”‚       â†“                          â”‚ â”‚
â”‚  â”‚  [SubAgent: FS] â†’ read_file      â”‚ â”‚
â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚  é¼ æ ‡æ‚¬æµ®æ˜¾ç¤ºè¯¦æƒ…                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### é€‰é¡¹ 2ï¼šç‹¬ç«‹ä¾§è¾¹æ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLINE Chat  â”‚  Agent Graph Panel    â”‚
â”‚  (ç°æœ‰)      â”‚  (æ–°å¢)               â”‚
â”‚              â”‚                       â”‚
â”‚  [User]      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  ä½ å¥½...     â”‚  â”‚  Main  â”‚           â”‚
â”‚              â”‚  â”‚  Agent â”‚           â”‚
â”‚  [CLINE]     â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â”‚
â”‚  æ­£åœ¨å¤„ç†... â”‚      â”‚                â”‚
â”‚              â”‚  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”           â”‚
â”‚              â”‚  â”‚SubAgentâ”‚           â”‚
â”‚              â”‚  â”‚   FS   â”‚ â— Active  â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚              â”‚                       â”‚
â”‚              â”‚  [Event Timeline]     â”‚
â”‚              â”‚  12:34:01 Connected   â”‚
â”‚              â”‚  12:34:02 Executing   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è°ƒè¯•å’Œç›‘æ§åŠŸèƒ½

### 1. è°ƒè¯•é¢æ¿åŠŸèƒ½

#### 1.1 äº‹ä»¶æ—¶é—´çº¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event Timeline                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [====|====|====|====|====]              â”‚
â”‚   â”‚    â”‚    â”‚    â”‚    â”‚                  â”‚
â”‚   â”‚    â”‚    â”‚    â”‚    â””â”€ Tool Completed  â”‚
â”‚   â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€ Output Stream   â”‚
â”‚   â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Tool Executing  â”‚
â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SubAgent Ready  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Connected       â”‚
â”‚                                          â”‚
â”‚  Filter: [All] [Main Agent] [SubAgents]  â”‚
â”‚  Time Range: [Last 5 min] [Custom]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 1.2 è°ƒç”¨æ ‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Call Tree                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Main Agent                              â”‚
â”‚  â””â”€ Task: Read and analyze file          â”‚
â”‚      â”œâ”€ SubAgent: FileSystem             â”‚
â”‚      â”‚   â”œâ”€ read_file("/src/main.py")    â”‚
â”‚      â”‚   â”‚   Duration: 120ms âœ“           â”‚
â”‚      â”‚   â””â”€ list_dir("/src")             â”‚
â”‚      â”‚       Duration: 45ms âœ“            â”‚
â”‚      â”‚                                    â”‚
â”‚      â””â”€ SubAgent: Git                    â”‚
â”‚          â””â”€ git_status()                 â”‚
â”‚              Duration: 230ms âœ“           â”‚
â”‚                                          â”‚
â”‚  Total Duration: 395ms                   â”‚
â”‚  Success Rate: 100%                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 1.3 æ€§èƒ½åˆ†æ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Performance Analysis                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Hot Tools (Top 5):                      â”‚
â”‚  1. read_file         156 calls  89ms    â”‚
â”‚  2. write_file         89 calls  145ms   â”‚
â”‚  3. list_dir           67 calls  34ms    â”‚
â”‚  4. git_status         45 calls  230ms   â”‚
â”‚  5. git_commit         23 calls  456ms   â”‚
â”‚                                          â”‚
â”‚  Slowest Operations:                     â”‚
â”‚  1. git_push          1.2s               â”‚
â”‚  2. database_query    890ms              â”‚
â”‚  3. git_commit        456ms              â”‚
â”‚                                          â”‚
â”‚  Bottleneck Analysis:                    â”‚
â”‚  âš  Git operations taking 60% of time    â”‚
â”‚  ğŸ’¡ Consider connection pooling          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 1.4 é”™è¯¯è¿½è¸ª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Error Tracking                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Recent Errors (Last 24h):               â”‚
â”‚                                          â”‚
â”‚  [12:34:01] âŒ read_file failed           â”‚
â”‚    SubAgent: filesystem_001              â”‚
â”‚    Error: ENOENT: File not found        â”‚
â”‚    Path: /invalid/path.txt               â”‚
â”‚    Stack: [View Full Stack]              â”‚
â”‚    Retry: [Retry] [Ignore]               â”‚
â”‚                                          â”‚
â”‚  [11:20:15] âŒ git_push failed            â”‚
â”‚    SubAgent: git_002                     â”‚
â”‚    Error: Authentication failed          â”‚
â”‚    Remote: origin                        â”‚
â”‚    [View Details] [Configure Auth]       â”‚
â”‚                                          â”‚
â”‚  Error Rate: 2.3% (3 / 130 ops)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®ç°è·¯çº¿å›¾

### Phase 1: æ ¸å¿ƒæ¶æ„ï¼ˆMVPï¼‰

**ç›®æ ‡**ï¼šå®ç°åŸºç¡€çš„ SubAgent æœºåˆ¶å’Œç®€å•å¯è§†åŒ–

**ä»»åŠ¡**ï¼š
1. âœ… è®¾è®¡ SubAgent æ•°æ®æ¨¡å‹
2. â¬œ å®ç° SubAgent Manager
3. â¬œ å®ç°å•ä¸ª SubAgentï¼ˆä»¥ FileSystem ä¸ºä¾‹ï¼‰
4. â¬œ é›†æˆåˆ° CLINE Core
5. â¬œ åŸºç¡€å›¾å¯è§†åŒ–ï¼ˆé™æ€ï¼‰
6. â¬œ ç®€å•çŠ¶æ€å±•ç¤º

**æ—¶é—´**ï¼š1-2 å‘¨

---

### Phase 2: å®æ—¶äº¤äº’

**ç›®æ ‡**ï¼šé¼ æ ‡æ‚¬æµ®æ˜¾ç¤ºè¯¦æƒ…ï¼Œå®æ—¶çŠ¶æ€æ›´æ–°

**ä»»åŠ¡**ï¼š
1. â¬œ å®ç° WebSocket äº‹ä»¶ç³»ç»Ÿ
2. â¬œ Event Bus è®¾è®¡å’Œå®ç°
3. â¬œ é¼ æ ‡æ‚¬æµ®é¢æ¿ UI
4. â¬œ å®æ—¶çŠ¶æ€åŒæ­¥
5. â¬œ åŸºç¡€åŠ¨ç”»æ•ˆæœ

**æ—¶é—´**ï¼š1 å‘¨

---

### Phase 3: æµå¼è¾“å‡º

**ç›®æ ‡**ï¼šæ”¯æŒå¤§è¾“å‡ºçš„å®æ—¶æ˜¾ç¤º

**ä»»åŠ¡**ï¼š
1. â¬œ æµå¼æ•°æ®å¤„ç†
2. â¬œ è¿›åº¦æ¡å’Œç™¾åˆ†æ¯”
3. â¬œ è¾“å‡ºé¢„è§ˆçª—å£
4. â¬œ äº‹ä»¶èŠ‚æµä¼˜åŒ–

**æ—¶é—´**ï¼š1 å‘¨

---

### Phase 4: æ€§èƒ½å’Œè°ƒè¯•

**ç›®æ ‡**ï¼šä¼˜åŒ–æ€§èƒ½ï¼Œæ·»åŠ è°ƒè¯•å·¥å…·

**ä»»åŠ¡**ï¼š
1. â¬œ è¿æ¥æ± å®ç°
2. â¬œ å†å²æ•°æ®ç®¡ç†
3. â¬œ äº‹ä»¶æ—¶é—´çº¿
4. â¬œ è°ƒç”¨æ ‘å¯è§†åŒ–
5. â¬œ æ€§èƒ½åˆ†æé¢æ¿
6. â¬œ é”™è¯¯è¿½è¸ªç³»ç»Ÿ

**æ—¶é—´**ï¼š2 å‘¨

---

## æŠ€æœ¯æ ˆ

### åç«¯
- **è¯­è¨€**ï¼šTypeScript / Node.js
- **æ¡†æ¶**ï¼šVSCode Extension API
- **MCP å®¢æˆ·ç«¯**ï¼š@modelcontextprotocol/sdk
- **WebSocket**ï¼šws
- **äº‹ä»¶ç³»ç»Ÿ**ï¼šEventEmitter / EventBus

### å‰ç«¯
- **æ¡†æ¶**ï¼šReact
- **å›¾å¯è§†åŒ–**ï¼šD3.js / React Flow
- **çŠ¶æ€ç®¡ç†**ï¼šZustand / Redux
- **WebSocket å®¢æˆ·ç«¯**ï¼šåŸç”Ÿ WebSocket API
- **æ ·å¼**ï¼šTailwind CSS / CSS Modules

### æ•°æ®å­˜å‚¨
- **å†…å­˜ç¼“å­˜**ï¼šLRU Cache
- **æŒä¹…åŒ–**ï¼šSQLiteï¼ˆVSCode Extension å†…ç½®ï¼‰
- **æ—¥å¿—**ï¼šæ–‡ä»¶ç³»ç»Ÿï¼ˆç»“æ„åŒ–æ—¥å¿—ï¼‰

---

## æ€»ç»“

æœ¬æ¶æ„é€šè¿‡ SubAgent æœºåˆ¶å®ç°äº†ï¼š

1. **è§£è€¦**ï¼šMain Agent ä¸“æ³¨äºå†³ç­–ï¼ŒSubAgent å¤„ç†å…·ä½“å·¥å…·è°ƒç”¨
2. **å¯è§‚æµ‹**ï¼šæ¯ä¸€æ­¥æ“ä½œéƒ½å¯è¿½è¸ªã€å¯è§†åŒ–ã€å¯è°ƒè¯•
3. **å¯æ‰©å±•**ï¼šè½»æ¾æ·»åŠ æ–°çš„ MCP æœåŠ¡ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒé€»è¾‘
4. **ç”¨æˆ·å‹å¥½**ï¼šå®æ—¶å±•ç¤º AI çš„å·¥ä½œæµç¨‹ï¼Œæå‡é€æ˜åº¦å’Œå¯æ§æ€§

é€šè¿‡å®æ—¶çš„å›¾å¯è§†åŒ–å’Œäº¤äº’å¼é¢æ¿ï¼Œç”¨æˆ·å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ï¼š
- AI æ­£åœ¨åšä»€ä¹ˆ
- è°ƒç”¨äº†å“ªäº›å·¥å…·
- æ¯ä¸ªå·¥å…·çš„è¾“å…¥è¾“å‡º
- æ‰§è¡Œæ—¶é—´å’Œæ€§èƒ½
- é”™è¯¯å’Œå¼‚å¸¸

è¿™å°†æ˜¾è‘—æå‡ CLINE çš„ç”¨æˆ·ä½“éªŒå’Œå¼€å‘æ•ˆç‡ã€‚
